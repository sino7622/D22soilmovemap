<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>å…¨å°åœŸçŸ³æ–¹è³‡æºå †ç½®è™•ç†å ´åˆ†å¸ƒåœ°åœ–</title>

    <!-- Leaflet + Cluster -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />

    <style>
        html,
        body {
            height: 100%;
        }

        body {
            margin: 0;
            font-family: "Segoe UI", "Noto Sans TC", sans-serif;
            background: #f5f7fa;
            color: #333;
            display: flex;
            flex-direction: column;
        }

        header {
            background: #1f3a5f;
            color: #fff;
            padding: 14px 20px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        header h1 {
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 16px 20px;
            gap: 12px;
            min-height: 0;
        }

        /* ä¸Šæ–¹ï¼šå·¥å…· + è³‡è¨ŠåŒä¸€è¡Œ */
        .top-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
        }

        /* å·¦ï¼šæ›´æ–°è³‡æ–™ */
        .toolbar {
            display: flex;
            align-items: center;
        }

        /* å³ï¼šinfo-card + ä¸‹è¼‰æŒ‰éˆ•ç¾¤ */
        .right-panel {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .download-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .btn {
            padding: 8px 14px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: #e0e6ed;
            color: #333;
            transition: all 0.2s ease;
            user-select: none;
            line-height: 1.1;
        }

        .btn:hover {
            background: #cfd8e3;
        }

        .btn-primary {
            background: #2563eb;
            color: #fff;
        }

        .btn-primary:hover {
            background: #1e4fd6;
        }

        .btn-success {
            background: #16a34a;
            color: #fff;
        }

        .btn-success:hover {
            background: #12803a;
        }

        .btn-danger {
            background: #dc2626;
            color: #fff;
        }

        .btn-danger:hover {
            background: #b91c1c;
        }

        .btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .info-card {
            background: #fff;
            border-radius: 10px;
            padding: 8px 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            font-size: 13px;
            white-space: nowrap;
        }

        #infoCard {
            display: none;
        }

        /* åœ°åœ–é«˜åº¦è·Ÿç€è¦½å™¨èµ°ï¼šflex æ’æ»¿å‰©é¤˜é«˜åº¦ */
        #map {
            flex: 1;
            min-height: 520px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            background: #ddd;
            min-height: 0;
        }

        footer {
            padding: 10px 14px;
            text-align: center;
            font-size: 12px;
            color: #777;
            background: transparent;
        }

        @media (max-width: 768px) {
            .top-row {
                flex-direction: column;
                align-items: stretch;
            }

            .right-panel {
                justify-content: flex-start;
            }

            .info-card {
                white-space: normal;
            }
        }

        /* æŒ‡åŒ—é‡ */
        .north-arrow {
            position: relative;
            background: rgba(255, 255, 255, 0.92);
            width: 44px;
            height: 44px;
            border-radius: 50%;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        .north-arrow::before {
            content: 'â™¦';
            font-size: 30px;
            line-height: 1;
            display: block;
            color: #111;
            transform: translateY(1px);
        }

        .north-arrow::after {
            content: 'N';
            position: absolute;
            top: 2px;
            font-size: 12px;
            font-weight: 800;
            color: #111;
        }
    </style>
</head>

<body>
    <header>
        <h1>å…¨å°åœŸçŸ³æ–¹è³‡æºå †ç½®è™•ç†å ´åˆ†å¸ƒåœ°åœ–</h1>
    </header>

    <div class="container">
        <div class="top-row">
            <!-- å·¦ï¼šæ›´æ–° + KML ä¸Šå‚³ -->
            <div class="toolbar">
                <div class="download-group">
                    <a class="btn btn-primary" id="btnUpdate" href="javascript:void(0)" onclick="update()">ğŸ”„ æ›´æ–°è³‡æ–™</a>

                    <a class="btn btn-primary" href="javascript:void(0)"
                        onclick="document.getElementById('kmlUpload').click();">ğŸ“¤ ä¸Šå‚³ KML</a>
                    <input type="file" id="kmlUpload" accept=".kml" style="display:none;">
                </div>
            </div>

            <!-- å³ï¼šè³‡è¨Šå¡ + æ§åˆ¶ + ä¸‹è¼‰ -->
            <div class="right-panel">
                <div class="info-card" id="infoCard">
                    â± æ›´æ–°ï¼š<strong><span id="time"></span></strong>
                    ï½œ ğŸ“ ç­†æ•¸ï¼š<strong><span id="count"></span></strong>
                </div>

                <div class="download-group">
                    <a class="btn btn-success" id="btnToggleSuspended" href="javascript:void(0)"
                        onclick="toggleSuspended()">ğŸš« éš±è—æš«åœç«™é»</a>

                    <a class="btn btn-success" id="btnExcel" href="javascript:void(0)" target="_blank" rel="noopener">ğŸ“¥
                        Excel</a>
                    <a class="btn btn-success" id="btnKml" href="javascript:void(0)" target="_blank" rel="noopener">ğŸ“¥
                        KML</a>

                    <a class="btn btn-danger" href="https://www.soilmove.tw/" target="_blank"
                        rel="noopener noreferrer">ğŸŒ è³‡æ–™ä¾†æºï¼šç‡Ÿå»ºå‰©é¤˜åœŸçŸ³æ–¹è³‡è¨Šæœå‹™ä¸­å¿ƒ</a>
                </div>
            </div>
        </div>

        <div id="map"></div>
    </div>

    <footer>
        æœ¬ç³»çµ±åƒ…ä½œè³‡æ–™è¦–è¦ºåŒ–å±•ç¤ºï¼Œå¯¦éš›è³‡è¨Šè«‹ä»¥å®˜æ–¹è³‡æ–™ä¾†æºç‚ºæº–<br />
        <span style="color:#999;">Â© æœ¬ç¶²ç«™ç‚ºä¸­èˆˆå·¥ç¨‹åœ’è·¯éƒ¨é–‹ç™¼åŠç¶­è­·ï¼ˆç‰ˆæœ¬ï¼šv1ï¼‰</span>
    </footer>

    <!-- JS libs -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>

    <!-- KML -> GeoJSON -->
    <script src="https://unpkg.com/@tmcw/togeojson@6.0.0/dist/togeojson.umd.js"></script>

    <!-- Proj4 (EPSG:3826 -> 4326) -->
    <script src="https://unpkg.com/proj4@2.9.2/dist/proj4.js"></script>

    <script>
        // =========================
        // 0) Render APIï¼ˆæ”¹æˆä½ çš„ï¼‰
        // =========================
        const API_BASE = "https://d22soilmovemap.onrender.com";

        // =========================
        // 1) IndexedDB å¿«å–ï¼ˆå‰ç«¯æš«å­˜ï¼‰
        // =========================
        const DB_NAME = "soilmove_cache_db";
        const DB_VER = 1;
        const STORE = "cache";

        function idbOpen() {
            return new Promise((resolve, reject) => {
                const req = indexedDB.open(DB_NAME, DB_VER);
                req.onupgradeneeded = () => {
                    const db = req.result;
                    if (!db.objectStoreNames.contains(STORE)) db.createObjectStore(STORE);
                };
                req.onsuccess = () => resolve(req.result);
                req.onerror = () => reject(req.error);
            });
        }

        async function idbGet(key) {
            const db = await idbOpen();
            return new Promise((resolve, reject) => {
                const tx = db.transaction(STORE, "readonly");
                const st = tx.objectStore(STORE);
                const req = st.get(key);
                req.onsuccess = () => resolve(req.result ?? null);
                req.onerror = () => reject(req.error);
                tx.oncomplete = () => db.close();
            });
        }

        async function idbSet(key, value) {
            const db = await idbOpen();
            return new Promise((resolve, reject) => {
                const tx = db.transaction(STORE, "readwrite");
                const st = tx.objectStore(STORE);
                const req = st.put(value, key);
                req.onsuccess = () => resolve(true);
                req.onerror = () => reject(req.error);
                tx.oncomplete = () => db.close();
            });
        }

        // =========================
        // 2) Proj4: EPSG:3826 (TWD97 TM2 zone 121)
        // =========================
        proj4.defs("EPSG:3826",
            "+proj=tmerc +lat_0=0 +lon_0=121 +k=0.9999 +x_0=250000 +y_0=0 +ellps=GRS80 +units=m +no_defs"
        );

        function transformGeoJSON_3826_to_4326(geojson) {
            function transformCoords(coords) {
                if (typeof coords[0] === "number") {
                    const [lng, lat] = proj4("EPSG:3826", "EPSG:4326", coords);
                    return [lng, lat];
                }
                return coords.map(transformCoords);
            }

            if (!geojson || !geojson.features) return geojson;
            geojson.features.forEach(f => {
                if (f && f.geometry && f.geometry.coordinates) {
                    f.geometry.coordinates = transformCoords(f.geometry.coordinates);
                }
            });
            return geojson;
        }

        // =========================
        // 3) UI æ§åˆ¶ï¼šinfo-card
        // =========================
        function setInfoCardVisible(isVisible) {
            const el = document.getElementById("infoCard");
            if (!el) return;
            el.style.display = isVisible ? "block" : "none";
        }

        function setBtnLoading(btnEl, loadingText, normalText, isLoading) {
            if (!btnEl) return;
            if (isLoading) {
                btnEl.classList.add("disabled");
                btnEl.style.pointerEvents = "none";
                btnEl.textContent = loadingText;
            } else {
                btnEl.classList.remove("disabled");
                btnEl.style.pointerEvents = "auto";
                btnEl.textContent = normalText;
            }
        }

        // =========================
        // 4) åœ°åœ–åº•åœ– + æ§åˆ¶
        // =========================
        const baseOSM = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
            maxZoom: 19,
            attribution: "&copy; OpenStreetMap"
        });

        const baseImagery = L.tileLayer(
            "https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",
            { maxZoom: 19, attribution: "Tiles &copy; Esri" }
        );

        const map = L.map("map", {
            center: [23.7, 121],
            zoom: 7,
            layers: [baseOSM]
        });

        L.control.layers({ "ä¸€èˆ¬åœ°åœ–": baseOSM, "èˆªç…§åœ–": baseImagery }, null, { position: "topright" }).addTo(map);

        // æ¯”ä¾‹å°º
        L.control.scale({ position: "bottomleft", metric: true, imperial: false }).addTo(map);

        // æŒ‡åŒ—é‡
        const northArrow = L.control({ position: "topleft" });
        northArrow.onAdd = function () {
            return L.DomUtil.create("div", "north-arrow");
        };
        northArrow.addTo(map);

        // =========================
        // 5) ç¾¤èšåœ–å±¤
        // =========================
        const cluster = L.markerClusterGroup({
            maxClusterRadius: 60,
            disableClusteringAtZoom: 11,
            spiderfyOnMaxZoom: true,
            showCoverageOnHover: false,
            zoomToBoundsOnClick: true
        });
        map.addLayer(cluster);

        // =========================
        // 6) PIN iconï¼ˆSVG dataURLï¼‰
        // =========================
        function makePinDataUrl(fillColor) {
            const svg = `
        <svg xmlns="http://www.w3.org/2000/svg" width="26" height="41" viewBox="0 0 26 41">
          <path d="M13 0C6.37 0 1 5.37 1 12c0 9 12 29 12 29s12-20 12-29C25 5.37 19.63 0 13 0z"
                fill="${fillColor}" stroke="rgba(0,0,0,0.35)" stroke-width="1"/>
          <circle cx="13" cy="12" r="5" fill="rgba(255,255,255,0.95)"/>
        </svg>
      `.trim();
            return "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(svg);
        }

        function makePinIcon(fillColor) {
            return L.icon({
                iconUrl: makePinDataUrl(fillColor),
                iconSize: [26, 41],
                iconAnchor: [13, 41],
                popupAnchor: [0, -36]
            });
        }

        const blueIcon = makePinIcon("#2563eb");
        const grayIcon = makePinIcon("#6b7280");

        // =========================
        // 7) åœ–ä¾‹ï¼ˆå³ä¸‹è§’ï¼‰
        // =========================
        const legend = L.control({ position: "bottomright" });
        legend.onAdd = function () {
            const div = L.DomUtil.create("div", "map-legend");
            div.innerHTML = `
        <div style="
          background:#fff;
          padding:10px 12px;
          border-radius:8px;
          box-shadow:0 2px 6px rgba(0,0,0,0.2);
          font-size:13px;
          line-height:1.6;
        ">
          <div style="font-weight:600; margin-bottom:6px;">åœ–ä¾‹</div>

          <div style="display:flex; align-items:center; gap:8px;">
            <span style="display:inline-flex; width:14px; height:14px; border-radius:50%; background:#2563eb;"></span>
            <span>æ­£å¸¸ç‡Ÿé‹ï¼ˆè—è‰²ï¼‰</span>
          </div>

          <div style="display:flex; align-items:center; gap:8px; margin-top:4px;">
            <span style="display:inline-flex; width:14px; height:14px; border-radius:50%; background:#6b7280;"></span>
            <span>æš«åœ / åœæ­¢ï¼ˆæ·±ç°ï¼‰</span>
          </div>
        </div>
      `;
            return div;
        };
        legend.addTo(map);

        // =========================
        // 8) è³‡æ–™æ¸²æŸ“ + æš«åœç«™é»æ§åˆ¶
        // =========================
        let showSuspended = true;
        let lastData = [];

        function isSuspended(name) {
            if (!name) return false;
            return name.includes("æš«åœ") || name.includes("åœæ­¢") || name.includes("åœå ´") || name.includes("çµ‚æ­¢");
        }

        // âœ… Popup æ¬„ä½ç¶­æŒåŸç‰ˆå®Œæ•´ç‰ˆ
        function render(data) {
            cluster.clearLayers();
            lastData = Array.isArray(data) ? data : [];

            lastData.forEach(d => {
                const suspended = isSuspended(d.dumpname);

                // è‹¥é—œé–‰é¡¯ç¤ºæš«åœ â†’ ç›´æ¥è·³é
                if (!showSuspended && suspended) return;

                const icon = suspended ? grayIcon : blueIcon;

                const popupHtml = `
          <strong>${d.dumpname || "æœªå‘½å"}</strong><br/>
          <b>ç¸£å¸‚ï¼š</b> ${d.city || ""}<br/>
          <b>é¡å‹ï¼š</b> ${d.typename || ""}<br/>
          <b>æµå‘ç·¨è™Ÿï¼š</b> ${d.controlId || ""}<br/>
          <b>ç”³å ±æ—¥æœŸï¼š</b> ${d.applydate || ""}<br/>
          <hr/>
          <b>B1~B7 å‰©é¤˜å¡«åŸ‹é‡ï¼š</b> ${d.remain || ""} ã¥<br/>
          <b>B1~B7 æ ¸å‡†å¡«åŸ‹é‡ï¼š</b> ${d.maxbury || ""} ã¥<br/>
          <b>é¢ç©ï¼š</b> ${d.area || ""} å…¬é ƒ<br/>
          <hr/>
          <b>ç¶“åº¦ï¼š</b> ${d.lng}<br/>
          <b>ç·¯åº¦ï¼š</b> ${d.lat}<br/>
          ${suspended ? '<hr/><b style="color:#6b7280;">ç‹€æ…‹ï¼šæš«åœä¸­</b>' : ""}
        `;

                const m = L.marker([d.lat, d.lng], { icon }).bindPopup(popupHtml);
                cluster.addLayer(m);
            });
        }

        function toggleSuspended() {
            showSuspended = !showSuspended;

            const btn = document.getElementById("btnToggleSuspended");
            if (btn) btn.textContent = showSuspended ? "ğŸš« éš±è—æš«åœç«™é»" : "ğŸ‘ é¡¯ç¤ºæš«åœç«™é»";

            render(lastData);
        }

        // =========================
        // 9) æ›´æ–°ï¼šæŒ‰ä¸€ä¸‹æŠ“æœ€æ–° + å­˜ IndexedDB
        // =========================
        async function update() {
            const btn = document.getElementById("btnUpdate");
            setBtnLoading(btn, "â³ æ›´æ–°ä¸­...", "ğŸ”„ æ›´æ–°è³‡æ–™", true);
            setInfoCardVisible(false);

            try {
                // Render å…è²»æ–¹æ¡ˆå¸¸è¦‹ï¼šå…ˆ GET å–šé†’
                await fetch(`${API_BASE}/healthz`, { method: "GET", cache: "no-store" });

                const r = await fetch(`${API_BASE}/api/update`, { cache: "no-store" });
                if (!r.ok) throw new Error(`API error: ${r.status}`);
                const d = await r.json();

                // æ›´æ–°ç•«é¢
                document.getElementById("time").textContent = d.updated || "";
                document.getElementById("count").textContent = (d.count ?? (d.data?.length ?? 0));
                render(d.data || []);
                setInfoCardVisible(true);

                // ä¸‹è¼‰æŒ‰éˆ•æŒ‡å‘å¾Œç«¯
                const excelBtn = document.getElementById("btnExcel");
                const kmlBtn = document.getElementById("btnKml");
                if (excelBtn && d.excel_url) excelBtn.href = `${API_BASE}${d.excel_url}`;
                if (kmlBtn && d.kml_url) kmlBtn.href = `${API_BASE}${d.kml_url}`;

                // å­˜å¿«å–
                await idbSet("soilmove_latest", {
                    updated: d.updated,
                    count: d.count,
                    data: d.data || [],
                    excel_url: d.excel_url || "",
                    kml_url: d.kml_url || ""
                });

                alert(`æ›´æ–°å®Œæˆï¼Œå…± ${d.count} ç­†è³‡æ–™ï¼ˆå·²æš«å­˜æ–¼æœ¬æ©Ÿç€è¦½å™¨ï¼‰`);
            } catch (e) {
                console.error(e);
                alert("æ›´æ–°å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼ˆå¯èƒ½æ˜¯ Render é‚„åœ¨å–šé†’æˆ–ä¾†æºç«™ç•°å¸¸ï¼‰");
                // ä¸æ¸…å¿«å–ï¼Œè®“èˆŠè³‡æ–™å¯ç”¨
            } finally {
                setBtnLoading(btn, "â³ æ›´æ–°ä¸­...", "ğŸ”„ æ›´æ–°è³‡æ–™", false);
            }
        }

        // =========================
        // 10) é–‹é ï¼šå…ˆè¼‰å…¥å¿«å–ï¼ˆç§’é¡¯ç¤ºï¼‰
        // =========================
        async function loadCacheOnStart() {
            try {
                const cached = await idbGet("soilmove_latest");
                if (!cached) return;

                document.getElementById("time").textContent = cached.updated || "";
                document.getElementById("count").textContent = (cached.count ?? (cached.data?.length ?? 0));
                render(cached.data || []);
                setInfoCardVisible(true);

                // å¿«å–ä¹Ÿé †ä¾¿æ¢å¾©ä¸‹è¼‰æŒ‰éˆ•é€£çµï¼ˆå¦‚æœæ›¾æ›´æ–°éï¼‰
                const excelBtn = document.getElementById("btnExcel");
                const kmlBtn = document.getElementById("btnKml");
                if (excelBtn && cached.excel_url) excelBtn.href = `${API_BASE}${cached.excel_url}`;
                if (kmlBtn && cached.kml_url) kmlBtn.href = `${API_BASE}${cached.kml_url}`;
            } catch (e) {
                console.warn("loadCacheOnStart failed:", e);
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            loadCacheOnStart();
        });

        // =========================
        // 11) KML ä¸Šå‚³é¡¯ç¤ºç¯„åœï¼ˆé¿å…æ­ªæ‰ï¼šåµæ¸¬å…¬å°ºåº§æ¨™â†’è½‰æ›ï¼‰
        // =========================
        let kmlLayer = null;

        document.getElementById("kmlUpload").addEventListener("change", function (e) {
            const file = e.target.files[0];
            if (!file) return;

            if (!file.name.toLowerCase().endsWith(".kml")) {
                alert("è«‹ä¸Šå‚³ KML æª”æ¡ˆ");
                return;
            }

            const reader = new FileReader();
            reader.onload = function (event) {
                try {
                    const kmlText = event.target.result;

                    // KML -> XML
                    const parser = new DOMParser();
                    const kmlDom = parser.parseFromString(kmlText, "text/xml");

                    // XML -> GeoJSONï¼ˆUMD: toGeoJSONï¼‰
                    if (typeof toGeoJSON === "undefined") {
                        alert("ç¼ºå°‘ toGeoJSON å¥—ä»¶ï¼Œè«‹ç¢ºèªå·²è¼‰å…¥");
                        return;
                    }

                    let geojson = toGeoJSON.kml(kmlDom);
                    if (!geojson || !geojson.features || geojson.features.length === 0) {
                        alert("KML ä¸­æ²’æœ‰å¯é¡¯ç¤ºçš„åœ–å½¢");
                        return;
                    }

                    // åµæ¸¬æ˜¯å¦åƒå…¬å°ºåº§æ¨™ï¼ˆè¶…éç¶“ç·¯åº¦ç¯„åœï¼‰
                    const first = geojson.features?.[0]?.geometry?.coordinates;
                    const flat = Array.isArray(first) ? first.flat(Infinity) : [];
                    const sample = (flat.length >= 2) ? [flat[0], flat[1]] : null;

                    if (sample && typeof sample[0] === "number") {
                        const x = sample[0], y = sample[1];
                        // ç¶“ç·¯åº¦æ­£å¸¸ç¯„åœå¤§è‡´ |lng|<=180, |lat|<=90
                        // è‹¥è¶…å‡ºï¼Œè¦–ç‚ºæŠ•å½±åº§æ¨™ï¼ˆå¤šåŠæ˜¯ 3826 å…¬å°ºï¼‰
                        if (Math.abs(x) > 180 || Math.abs(y) > 90) {
                            geojson = transformGeoJSON_3826_to_4326(geojson);
                        }
                    }

                    // æ¸…æ‰èˆŠåœ–å±¤
                    if (kmlLayer) map.removeLayer(kmlLayer);

                    // é¡¯ç¤º GeoJSON
                    kmlLayer = L.geoJSON(geojson, {
                        style: f => {
                            const t = f?.geometry?.type || "";
                            if (t.includes("Line")) {
                                return { color: "#ff0000", weight: 5, opacity: 1 };
                            }
                            return { color: "#ff0000", weight: 2, fillColor: "#ff0000", fillOpacity: 0.12 };
                        }
                    }).addTo(map);

                    // ç¸®æ”¾åˆ°ç¯„åœ
                    map.fitBounds(kmlLayer.getBounds(), { padding: [20, 20] });
                } catch (err) {
                    console.error(err);
                    alert("KML è§£æå¤±æ•—ï¼Œè«‹ç¢ºèªæª”æ¡ˆå…§å®¹æ­£ç¢º");
                } finally {
                    // å…è¨±é‡è¤‡ä¸Šå‚³åŒæª”
                    e.target.value = "";
                }
            };

            reader.readAsText(file, "UTF-8");
        });
    </script>
</body>

</html>